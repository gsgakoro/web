<!doctype html>
<html lang="rw">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GS GAKORO — Discipline/Indiscipline Scoring Form</title>
  <style>
    :root {
      --bg: #0a1128;      /* Deep navy blue */
      --card: #112240;    /* Dark blue-gray card */
      --muted: #7d90b8;   /* Muted bluish-gray */
      --text: #e0e8ff;    /* Light bluish text */
      --accent: #3b82f6;  /* Blue accent */
      --accent-2: #2563eb; /* Darker blue accent */
      --danger: #ef4444;
      --warning: #f59e0b;
    }

    * { box-sizing: border-box; }
    body {
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background:linear-gradient(180deg, #071021, var(--bg) 40%, #071021);
      color:var(--text);
    }
    .wrap { max-width: 980px; margin: 24px auto; padding: 16px; }
    .card {
      background: rgba(17,34,64,.75);
      backdrop-filter: blur(6px);
      border:1px solid rgba(125,144,184,.25);
      border-radius: 18px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,.4);
    }
    h1 { margin:0 0 10px; font-size: clamp(22px, 2.6vw, 32px); letter-spacing:.3px; }
    .row { display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width: 720px) { .row{ grid-template-columns: 1fr 1fr 1fr; } }
    label { font-size: 14px; color: var(--muted); display:block; margin-bottom:6px; }
    input[type="text"], select {
      width:100%;
      border-radius: 12px;
      border:1px solid rgba(125,144,184,.35);
      padding:12px 14px;
      background:#0d1a3a;
      color:var(--text);
      outline:none;
    }
    .section { margin-top: 18px; }
    .section h2 {
      font-size: clamp(16px, 2vw, 20px);
      margin: 0 0 8px;
      color:#cdd9f0;
    }
    .question {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:10px 12px;
      border:1px solid rgba(125,144,184,.25);
      border-radius: 14px;
      background: rgba(8,20,48,.65);
    }
    .qtext { flex: 1 1 auto; font-size:14px; line-height:1.35; color:#e6ecff; }
    .yn { display:flex; gap:10px; white-space:nowrap; }
    .pill {
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 12px;
      border-radius: 999px;
      border:1px solid rgba(125,144,184,.35);
      cursor:pointer;
      user-select:none;
    }
    .pill input {
      appearance:none;
      width:16px;
      height:16px;
      border-radius:50%;
      border:2px solid #7d90b8;
      display:inline-block;
      position:relative;
    }
    .pill input:checked {
      border-color: var(--accent);
      box-shadow: inset 0 0 0 4px var(--accent);
    }
    .pill.danger input:checked {
      border-color: var(--danger);
      box-shadow: inset 0 0 0 4px var(--danger);
    }

    .stats {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      margin-top: 16px;
    }
    @media (min-width:720px){ .stats{ grid-template-columns: repeat(4, 1fr);} }
    .kpi {
      background: #0d1a3a;
      border:1px solid rgba(125,144,184,.35);
      border-radius:16px;
      padding:12px;
      text-align:center;
    }
    .kpi .label { font-size:12px; color:#a3b5dd; }
    .kpi .value { font-weight:700; font-size: 22px; margin-top:6px; }

    .actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:16px; }
    button { appearance:none; border:0; border-radius: 14px; padding:12px 14px; font-weight:600; cursor:pointer; }
    .primary { background: var(--accent-2); color:white; }
    .ghost { background: transparent; color:#cbd5e1; border:1px solid rgba(125,144,184,.35); }
    .note { font-size:12px; color:#94a3b8; margin-top: 6px; }
    .footer { text-align:center; margin-top: 16px; font-size: 12px; color: #94a3b8; }
    .hidden { display:none !important; }
    .divider { height:1px; background: rgba(125,144,184,.3); margin: 14px 0; }
    .success { color: #34d399; }
    .error { color: var(--danger); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>GS GAKORO — Discipline/Indiscipline Scoring</h1>
      <p class="note">Yes = 2, No = 0. First pick a student; questions will appear. You can submit results to your Google Sheet.</p>

      <div class="row">
        <div>
          <label>Teacher</label>
          <input id="teacher" type="text" placeholder="e.g., Mr. John" />
        </div>
        <div>
          <label>Class</label>
          <input id="clazz" type="text" placeholder="e.g., S001" />
        </div>
        <div>
          <label>Student Name</label>
          <select id="student" disabled>
            <option value="">Loading student names…</option>
          </select>
          <div id="studentLoadMsg" class="note"></div>
        </div>
      </div>

      <div id="questions" class="hidden">
        <div class="section">
          <h2>Positive Behaviours</h2>
          <div id="positiveList" class="stack" style="display:grid; gap:10px;"></div>
        </div>
        <div class="section">
          <h2>Negative Behaviours</h2>
          <div id="negativeList" class="stack" style="display:grid; gap:10px;"></div>
        </div>

        <div class="stats">
          <div class="kpi"><div class="label">Discipline (sum of positives)</div><div id="kpiDis" class="value">0</div></div>
          <div class="kpi"><div class="label">Indiscipline (sum of negatives)</div><div id="kpiIndis" class="value">0</div></div>
          <div class="kpi"><div class="label">Ratio (Discipline / Total)</div><div id="kpiRatio" class="value">0%</div></div>
          <div class="kpi"><div class="label">Total Score</div><div id="kpiTotal" class="value">0</div></div>
        </div>

        <div class="actions">
          <button id="clearBtn" class="ghost" type="button">Clear</button>
          <button id="submitBtn" class="primary" type="button">Submit to Sheet</button>
        </div>
        <div id="submitMsg" class="note"></div>
      </div>

      <div class="footer">© <span id="year"></span> GS GAKORO · Built for quick classroom check-ins</div>
    </div>
  </div>

  <script>
    const NAMES_URL = "https://script.google.com/macros/s/AKfycbw0h0w_0vSBnBmedQ2gWVdHuLc_jAG7jQHHRdrf_WLU_OMNBUA7xOahI7EiR5JNoh9f/exec?action=names";
    const SUBMIT_URL = "https://script.google.com/macros/s/AKfycbw0h0w_0vSBnBmedQ2gWVdHuLc_jAG7jQHHRdrf_WLU_OMNBUA7xOahI7EiR5JNoh9f/exec";

    const POSITIVE = [
      { key: 'raise_hand', label: "Arasubiza mu masomo (Raise hand in class)" },
      { key: 'on_time', label: "Agerera ku gihe mu ishuri (Arrive to class on time)" },
      { key: 'do_as_told', label: "Akora ibyo mbwirwa (Do what I am told)" },
      { key: 'behave_sub', label: "Yitwara neza igihe umwarimu adahari (Behave for a substitute)" },
      { key: 'materials', label: "Afite ibikoresho byose by’ishuri (Have all materials for class)" },
      { key: 'help_teacher', label: "Afasha umwarimu igihe abisabwe (Help teacher when asked)" },
      { key: 'polite', label: "Yitwara neza (Act politely)" },
      { key: 'pay_attention', label: "Arakurikira mu ishuri (Pay attention in class)" },
      { key: 'clean_desk', label: "Akora cg Agira isuku (Clean up desk area)" },
      { key: 'extra_duties', label: "Afata inshingano zinyongera mu ishuri (Accept extra duties in class like a group leader)" },
    ];

    const NEGATIVE = [
      { key: 'act_up_line', label: "Akora akajagari ku murongo (Act up in line)" },
      { key: 'talk_in_class', label: "Asakuza mu ishuri (Talk in class)" },
      { key: 'write_on_desks', label: "Yandika ku meza y'banyeshuri (Write on desks)" },
      { key: 'disorderly', label: "Arajagaraye mu ishuri (Disorderly)" },
      { key: 'lean_back', label: "Yicara mu buryo butari bwo (Lean back in chairs)" },
      { key: 'chew_gum', label: "Kuryagagura mu ishuri (Chew gum in class)" },
      { key: 'throw_objects', label: "Atera ibintu mu ishuri (Throw objects in class)" },
      { key: 'touch_others', label: "Arenderanya (Touch other students)" },
      { key: 'take_things', label: "Afata ibyo abandi bafite (Take other’s things)" },
      { key: 'abusive_language', label: "Akoresha amagambo akomeretsa cyangwa ashinyagura (Use abusive language)" },
    ];

    const YES = 2, NO = 0;
    const $ = (sel) => document.querySelector(sel);
    const byId = (id) => document.getElementById(id);

    const state = { answers: {}, discipline: 0, indiscipline: 0, total: 0, ratio: 0 };

    function renderQuestions() {
      const positiveList = byId('positiveList');
      const negativeList = byId('negativeList');
      positiveList.innerHTML = '';
      negativeList.innerHTML = '';

      function mkQuestion(item, group) {
        const row = document.createElement('div');
        row.className = 'question';
        const text = document.createElement('div');
        text.className = 'qtext';
        text.textContent = item.label;

        const yn = document.createElement('div');
        yn.className = 'yn';

        const yesLbl = document.createElement('label');
        yesLbl.className = 'pill';
        const yes = document.createElement('input');
        yes.type = 'radio'; yes.name = item.key; yes.value = YES;
        yes.addEventListener('change', ()=> setAnswer(item.key, YES, group));
        yesLbl.appendChild(yes); yesLbl.appendChild(document.createTextNode('Yes (2)'));

        const noLbl = document.createElement('label');
        noLbl.className = 'pill danger';
        const no = document.createElement('input');
        no.type = 'radio'; no.name = item.key; no.value = NO;
        no.addEventListener('change', ()=> setAnswer(item.key, NO, group));
        noLbl.appendChild(no); noLbl.appendChild(document.createTextNode('No (0)'));

        yn.appendChild(yesLbl); yn.appendChild(noLbl);
        row.appendChild(text); row.appendChild(yn);
        return row;
      }

      POSITIVE.forEach(item => positiveList.appendChild(mkQuestion(item, 'pos')));
      NEGATIVE.forEach(item => negativeList.appendChild(mkQuestion(item, 'neg')));
    }

    function setAnswer(key, val, group) {
      state.answers[key] = { value: Number(val), group };
      recalc();
    }

    function recalc() {
      let dis = 0, indis = 0;
      Object.values(state.answers).forEach(({value, group}) => {
        if (group === 'pos') dis += value; else if (group === 'neg') indis += value;
      });
      const total = dis + indis;
      const ratio = total > 0 ? Math.round((dis / total) * 100) : 0;
      state.discipline = dis; state.indiscipline = indis; state.total = total; state.ratio = ratio;
      byId('kpiDis').textContent = dis;
      byId('kpiIndis').textContent = indis;
      byId('kpiTotal').textContent = total;
      byId('kpiRatio').textContent = ratio + '%';
    }

    function clearForm() {
      state.answers = {}; state.discipline = state.indiscipline = state.total = state.ratio = 0;
      document.querySelectorAll('input[type=radio]').forEach(el => { el.checked = false; });
      recalc();
    }

    async function loadStudentNames() {
      const sel = byId('student');
      const msg = byId('studentLoadMsg');
      try {
        const res = await fetch(NAMES_URL, { method: 'GET' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        const names = Array.isArray(data.students) ? data.students : Array.isArray(data) ? data : [];
        sel.innerHTML = '<option value="">— Choose a student —</option>' + names.map(n => `<option>${String(n)}</option>`).join('');
        sel.disabled = false;
        msg.textContent = `Loaded ${names.length} names`;
      } catch (e) {
        sel.innerHTML = '<option value="">Failed to load names. Check NAMES_URL.</option>';
        msg.textContent = e.message;
      }
    }

    function ensureReady() {
      const teacher = byId('teacher').value.trim();
      const clazz = byId('clazz').value.trim();
      const student = byId('student').value.trim();
      if (!teacher || !clazz || !student) {
        alert('Please fill Teacher, Class, and choose a Student before submitting.');
        return null;
      }
      return { teacher, clazz, student };
    }

    async function submitResults() {
      const who = ensureReady();
      if (!who) return;
      const payload = {
        timestamp: new Date().toISOString(),
        teacher: who.teacher,
        class: who.clazz,
        studentName: who.student,
        answers: Object.fromEntries(Object.entries(state.answers).map(([k, v]) => [k, v.value])),
        discipline: state.discipline,
        indiscipline: state.indiscipline,
        ratio: state.ratio,
        score: state.total
      };
      const msg = byId('submitMsg');
      msg.textContent = 'Submitting…'; msg.className = 'note';
      try {
        const res = await fetch(SUBMIT_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json().catch(()=>({}));
        msg.textContent = data.message || 'Saved!';
        msg.className = 'note success';
      } catch (e) {
        msg.textContent = 'Submit failed: ' + e.message + ' (check SUBMIT_URL and permissions)';
        msg.className = 'note error';
      }
    }

    byId('clearBtn').addEventListener('click', clearForm);
    byId('submitBtn').addEventListener('click', submitResults);
    byId('student').addEventListener('change', () => { byId('questions').classList.toggle('hidden', !byId('student').value); });

    renderQuestions();
    loadStudentNames();
    byId('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>

