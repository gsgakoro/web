<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Discipline Reports | GS GAKORO</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h1 { color: #ff7a00; }
    select, button {
      padding: 10px 14px;
      margin: 6px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
    }
    select { background: #eee; }
    button {
      background: #2066b2;
      color: white;
    }
    button:hover { background: #164d82; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #ff7a00;
      color: white;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>GS GAKORO â€“ Discipline Reports</h1>

  <label for="classSelect"><b>Select Class:</b></label>
  <select id="classSelect">
    <option value="">--Choose--</option>
    <option value="S1A">S1A</option>
    <option value="S1B">S1B</option>
    <option value="S1C">S1C</option>
    <option value="S2A">S2A</option>
    <option value="S2B">S2B</option>
    <option value="S3A">S3A</option>
    <option value="S3B">S3B</option>
  </select>
  <button onclick="loadSheet()">Preview</button>
  <button onclick="downloadPDF()">Download PDF</button>

  <div id="preview"></div>

<script>
  // Map class names to published CSV URLs
  const sheetLinks = {
    "S1A": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3PA2uCJMkImTkjQz3K-FmgR3rJaTOuCpvN20S5vO-M9iznRDSkMyV6Px9IrSwFw8LWRBgRupp4NmL/pub?gid=35480693&single=true&output=csv",
    "S1B": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3PA2uCJMkImTkjQz3K-FmgR3rJaTOuCpvN20S5vO-M9iznRDSkMyV6Px9IrSwFw8LWRBgRupp4NmL/pub?gid=505752934&single=true&output=csv",
    "S1C": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3PA2uCJMkImTkjQz3K-FmgR3rJaTOuCpvN20S5vO-M9iznRDSkMyV6Px9IrSwFw8LWRBgRupp4NmL/pub?gid=1563305402&single=true&output=csv",
    "S2A": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3PA2uCJMkImTkjQz3K-FmgR3rJaTOuCpvN20S5vO-M9iznRDSkMyV6Px9IrSwFw8LWRBgRupp4NmL/pub?gid=1076797302&single=true&output=csv",
    "S2B": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3PA2uCJMkImTkjQz3K-FmgR3rJaTOuCpvN20S5vO-M9iznRDSkMyV6Px9IrSwFw8LWRBgRupp4NmL/pub?gid=790046109&single=true&output=csv",
    "S3A": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3PA2uCJMkImTkjQz3K-FmgR3rJaTOuCpvN20S5vO-M9iznRDSkMyV6Px9IrSwFw8LWRBgRupp4NmL/pub?gid=2059231041&single=true&output=csv",
    "S3B": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3PA2uCJMkImTkjQz3K-FmgR3rJaTOuCpvN20S5vO-M9iznRDSkMyV6Px9IrSwFw8LWRBgRupp4NmL/pub?gid=1973310230&single=true&output=csv"
  };

  let currentClass = "";
  let currentData = [];

  async function loadSheet() {
    currentClass = document.getElementById("classSelect").value;
    if (!currentClass) { alert("Please select a class"); return; }

    const url = sheetLinks[currentClass];
    if (!url) { alert("CSV link not found for this class"); return; }

    try {
      const res = await fetch(url);
      if (!res.ok) throw new Error("Failed to fetch CSV");
      const text = await res.text();

      currentData = parseCSV(text);
      renderTable(currentData);
    } catch (err) {
      alert("Error loading sheet: " + err.message);
    }
  }

  function parseCSV(text) {
    return text.trim().split("\n").map(row => row.split(","));
  }

  function renderTable(values) {
    let html = "<table><thead><tr>";
    values[0].forEach(h => { html += `<th>${h}</th>`; });
    html += "</tr></thead><tbody>";

    for (let i = 1; i < values.length; i++) {
      html += "<tr>";
      values[i].forEach(c => { html += `<td>${c}</td>`; });
      html += "</tr>";
    }
    html += "</tbody></table>";
    document.getElementById("preview").innerHTML = html;
  }

  function downloadPDF() {
    if (!currentData.length) { alert("No data loaded. Please preview first."); return; }
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Bold header (Right side)
    doc.setFont("helvetica", "bold");
    doc.setFontSize(12);
    doc.text("GS GAKORO", 200, 15, { align: "right" });
    doc.text("CLASS: " + currentClass, 200, 22, { align: "right" });
    doc.text("ACADEMIC YEAR 2025-2026", 200, 29, { align: "right" });

    // Title (center)
    doc.setFontSize(16);
    doc.text("Discipline Report", 105, 45, { align: "center" });

    // Table headers
    doc.setFontSize(12);
    doc.setFont("helvetica", "bold");
    let startY = 65;
    const colX = [20, 80, 130, 170]; // adjust if needed

    currentData[0].forEach((header, i) => {
      doc.text(header, colX[i], startY);
    });

    // Table rows
    doc.setFont("helvetica", "normal");
    let rowY = startY + 10;
    for (let i = 1; i < currentData.length; i++) {
      currentData[i].forEach((cell, j) => {
        doc.text(cell.toString(), colX[j], rowY);
      });
      rowY += 10;
    }

    doc.save(currentClass + "-DisciplineReport.pdf");
  }
</script>
</body>
</html>

